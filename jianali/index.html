<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trabajos Remotos en Canarias | Gana 150-300€ Diarios desde Casa</title>
  <meta name="description" content="Oportunidades exclusivas para residentes en Islas Canarias. Trabajos online con pagos diarios. ¡Solicita tu plaza ahora y comienza hoy mismo!" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"> 
  <link rel="stylesheet" href="style.css">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17524155246"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17524155246');
  </script>
</head>
<body>
  <!-- Top Nav -->
  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="#top" aria-label="Página principal">Trabajo</a>
      <nav class="nav-links">
        <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Menú">☰</button>
        <button class="btn btn-primary" id="openFormBtn">Solicitar Ahora</button>
      </nav>
      
      <!-- Mobile Menu -->
      <div class="mobile-menu" id="mobileMenu">
        <a href="#roles">Posiciones</a>
        <a href="#benefits">Beneficios</a>
        <a href="#faq">FAQ</a>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section id="top" class="hero">
    <div class="container hero-grid">
      <div class="hero-copy fade-in">
        <span class="urgency-badge">⏰ ¡ÚLTIMAS 12 VACANTES DISPONIBLES!</span>
        
        <h1>🌴 Canarios, Gana 150-300€ Diarios SIN Salir de Tu Casa</h1>
        <p class="subtitle">
          💼 Trabajos 100% online verificados para residentes de Tenerife, Gran Canaria, Lanzarote... 
          ¡Horarios flexibles compatibles con tu vida en las islas!
        </p>
		
		<div class="cta-main">
          <button class="btn btn-primary btn-lg pulse" id="heroCtaBtn">
            🚀 Quiero Mi Plaza - Comenzar en 24h
          </button>
          <p class="muted small" style="margin-top: 12px;">
            ⚡ Solo 1 minutos para registrar tu interés
          </p>
        </div>
		
        <div class="local-trust-badges fade-in">
          <div class="trust-badge">
            <span>🎵</span>
            <span>Escucha Música & Gana</span>
          </div>
          <div class="trust-badge">
            <span>🎬</span>
            <span>Ve Videos & Cobra</span>
          </div>
          <div class="trust-badge">
            <span>✍️</span>
            <span>Escribe Guías Turísticas</span>
          </div>
          <div class="trust-badge">
            <span>🌐</span>
            <span>Traducción Online</span>
          </div>
        </div>
		
		<!-- 小型倒计时器 -->
        <div class="compact-countdown" id="countdownContainer">
          <span>⏰ OFERTA TERMINA EN:</span>
          <span class="countdown-display" id="countdownTimer">30:00</span>
        </div>

        <!-- Live counters -->
        <div class="live-counter">
          <div class="counter-item">
            <span class="count" id="activeUsers">18</span>
            <span>personas viendo esta página</span>
          </div>
          <div class="counter-item">
            <span class="count" id="remainingSpots">3</span>
            <span>vacantes restantes</span>
          </div>
        </div>

        <!-- Real-time Registrations - 单条滚动样式 -->
        <div class="real-time-registrations">
          <div class="registrations-scroll-container" id="registrationsScrollContainer">
            <!-- 动态内容将在这里加载 -->
          </div>
        </div>

        <!-- Hero stats -->
        <div class="hero-stats">
          <div class="stat-item">
            <span class="stat-number">50.000+</span>
            <span class="stat-label">Canarios empleados</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">95%</span>
            <span class="stat-label">Satisfacción</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">24h</span>
            <span class="stat-label">Primer pago</span>
          </div>
        </div>

        <ul class="hero-points">
          <li>⏰ Horarios flexibles - Trabaja según tu propio horario</li>
          <li>💳 Pagos diarios - Cobra inmediatamente al completar tareas</li>
          <li>📱 Solo necesitas teléfono - No se requiere computadora</li>
          <li>🛡️ 100% seguro - Nunca hay tarifas de solicitud</li>
          <li>🇪🇸 Soporte en español - Atención por WhatsApp 24/7</li>
          <li>🌴 Ideal para canarios - Trabajos adaptados al mercado local</li>
        </ul>

        <div class="cta-main">
          <button class="btn btn-primary btn-lg pulse" id="heroCtaBtn">
            🚀 Quiero Mi Plaza - Comenzar en 24h
          </button>
          <p class="muted small" style="margin-top: 12px;">
            ⚡ Solo 1 minutos para registrar tu interés
          </p>
        </div>
      </div>
    </div>

    <div class="hero-bg" role="img" aria-label="Playa de las Islas Canarias"></div>
  </section>

  <!-- Trust Certification Section -->
  <section class="section">
    <div class="container">
      <div class="trust-certification fade-in">
        <div class="section-header">
          <h2>🔒 Confianza y Seguridad para Canarias</h2>
          <p class="muted">Garantías oficiales para tu tranquilidad</p>
        </div>
        <div class="trust-grid">
          <div class="trust-item">
            <div class="trust-icon">🏢</div>
            <h4>Registro Oficial en Canarias</h4>
            <p>Empresa registrada en el Gobierno de Canarias con número RB-284759</p>
          </div>
          <div class="trust-item">
            <div class="trust-icon">🛡️</div>
            <h4>Protección de Datos</h4>
            <p>Cumplimiento LOPD y RGPD para residentes canarios</p>
          </div>
          <div class="trust-item">
            <div class="trust-icon">💳</div>
            <h4>Pagos Garantizados</h4>
            <p>Sistema de pagos seguro con verificación bancaria española</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Scroll-triggered Trust Notification -->
  <div class="scroll-trust-section" id="scrollTrustSection">
    <button class="scroll-trust-close" id="scrollTrustClose">×</button>
    <div class="scroll-trust-content">
      <div class="trust-icon">🌟</div>
      <h4>¡Más de 1,200 Canarios Confían en Nosotros!</h4>
      <p>Únete a la comunidad de trabajadores remotos de las Islas Canarias</p>
    </div>
  </div>

  <!-- Sticky Bottom CTA -->
  <div class="sticky-bottom-cta" id="stickyCta">
    <div class="sticky-content">
      <span>🚀 <strong>Gana 150-300€/día</strong> - 12 Plazas</span>
      <button class="btn btn-primary pulse" onclick="openPhoneModal()">
        Solicitar Plaza Ahora
      </button>
    </div>
  </div>

  <!-- Phone Modal -->
  <div class="modal" id="phoneModal">
    <div class="modal-content" aria-labelledby="phoneModalTitle" role="dialog" aria-modal="true">
      <button class="modal-close" id="phoneModalCloseBtn" aria-label="Cerrar">&times;</button>
      
      <div class="modal-header">
        <div class="modal-icon">🎯</div>
        <h3 class="modal-title" id="phoneModalTitle">¡Plaza Reservada Exitosamente!</h3>
        <p class="modal-subtitle">Hemos reservado una de las últimas plazas disponibles. Completa tu registro para comenzar a ganar hoy mismo.</p>
      </div>

      <!-- Progress Indicator -->
      <div class="progress-indicator">
        <div class="progress-header">
          <span style="color: var(--muted);">Progreso de tu solicitud</span>
          <span style="font-weight: 600; color: var(--primary);">Paso 1 de 2</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressBar"></div>
        </div>
        <div class="progress-labels">
          <span>📝 Información</span>
          <span>💬 WhatsApp</span>
        </div>
      </div>

      <div class="phone-form">
        <div class="phone-input-group">
          <div class="country-code">
            <img src="https://flagcdn.com/w20/es.png" alt="Bandera de España" width="20" height="14" style="display:inline-block;vertical-align:middle;margin-right:8px;border-radius:2px;">
            +34
          </div>
          <input type="tel" id="phoneInput" class="phone-input" placeholder="6xx xxx xxx" inputmode="tel" maxlength="9" />
        </div>
        <div class="error-text" id="phoneError">Por favor ingresa tu número de WhatsApp</div>
        
        <button class="btn btn-primary btn-block pulse" id="startEarningBtn">
          💰 Comenzar a Ganar Ahora
        </button>
      </div>
      
      <!-- Direct WhatsApp Option -->
      <div class="direct-whatsapp-option">
        <p style="margin: 0 0 12px 0; font-size: 0.9rem;">¿Prefieres contactar directamente?</p>
        <button class="btn btn-whatsapp" id="directWhatsAppBtn">
          💬 Contactar por WhatsApp sin formulario
        </button>
      </div>
      
      <div class="security-badge">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 22C12 22 20 18 20 12V5L12 2L4 5V12C4 18 12 22 12 22Z" stroke="#20b2aa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M9 12L11 14L15 10" stroke="#20b2aa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Tus datos están 100% protegidos</span>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal" id="successModal">
    <div class="modal-content" aria-labelledby="successModalTitle" role="dialog" aria-modal="true">
      <button class="modal-close" id="successModalCloseBtn" aria-label="Cerrar">&times;</button>
      
      <div class="modal-header">
        <div class="modal-icon">🎉</div>
        <h3 class="modal-title" id="successModalTitle">¡Registro Completado!</h3>
        <p class="modal-subtitle">Estás a un paso de comenzar a ganar. Serás redirigido a WhatsApp para finalizar tu registro.</p>
      </div>

      <button class="btn btn-whatsapp btn-block pulse" id="goToWhatsAppBtn">
        <span class="loading-spinner" id="whatsappSpinner"></span>
        💬 Abrir WhatsApp Ahora
      </button>
      
      <div class="security-badge">
        <span>✅ Tu plaza está confirmada</span>
      </div>
    </div>
  </div>

  <!-- Hiring (Part-time & Full-time) -->
  <section id="roles" class="section">
    <div class="container">
      <div class="section-header fade-in">
        <h2>💰 Elige Tu Estilo de Trabajo Flexible</h2>
        <p class="muted">Los ingresos mostrados son rangos típicos reportados por trabajadores. <strong>Tus resultados pueden variar según tu desempeño personal.</strong></p>
      </div>

      <div class="cards two-col">
        <article class="card fade-in">
          <div class="card-media remote-work-1"></div>
          <div class="card-body">
            <div class="earnings-badge">50€–300€ / día</div>
            <h3>Trabajo a Tiempo Parcial</h3>
            <ul class="list">
              <li><strong>⏰ Horario flexible:</strong> 1–3 horas al día</li>
              <li><strong>💳 Pago:</strong> Diario tras completar tareas exitosas</li>
              <li><strong>📱 Herramientas:</strong> Solo teléfono inteligente</li>
              <li><strong>🎯 Habilidades:</strong> Alfabetización digital básica suficiente</li>
              <li><strong>🏠 Estilo de trabajo:</strong> Flexible, remoto</li>
              <li><strong>🌊 Ideal para:</strong> Estudiantes, complementar ingresos</li>
            </ul>
            <button class="btn btn-primary open-form-btn" style="margin-top: 16px;">Solicitar Tiempo Parcial</button>
          </div>
        </article>

        <article class="card fade-in delay-1">
          <div class="card-media remote-work-2"></div>
          <div class="card-body">
            <div class="earnings-badge">150€–500€+ / día</div>
            <h3>Trabajo a Tiempo Completo</h3>
            <ul class="list">
              <li><strong>⏰ Horario flexible:</strong> 3–6 horas al día</li>
              <li><strong>💳 Pago:</strong> Diario tras completar tareas exitosas</li>
              <li><strong>📱 Herramientas:</strong> Teléfono inteligente (PC opcional)</li>
              <li><strong>🎯 Habilidades:</strong> Se prefiere buena alfabetización digital</li>
              <li><strong>🏠 Estilo de trabajo:</strong> Flexible, remoto</li>
              <li><strong>🌊 Ideal para:</strong> Ingresos principales, profesionales</li>
            </ul>
            <button class="btn btn-primary open-form-btn" style="margin-top: 16px;">Solicitar Tiempo Completo</button>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- Flexible Work Bonus -->
  <section class="section alt">
    <div class="container">
      <div class="section-header fade-in">
        <h2>🎁 Gana Bonos Adicionales por Constancia</h2>
        <p class="muted">Mantente activo y desbloquea ingresos adicionales además de tus pagos regulares por tareas.</p>
      </div>
      
      <div class="cards three-col">
        <div class="card bonus fade-in">
          <div class="bonus-icon" aria-hidden="true">🎁</div>
          <h3>5 días</h3>
          <p>Desbloquea un pequeño bono por completar tareas durante 5 días activos este mes.</p>
        </div>
        <div class="card bonus fade-in delay-1">
          <div class="bonus-icon" aria-hidden="true">🏆</div>
          <h3>15 días</h3>
          <p>Mantén una actividad constante durante 15 días para ganar un bono incrementado.</p>
        </div>
        <div class="card bonus fade-in delay-2">
          <div class="bonus-icon" aria-hidden="true">⭐</div>
          <h3>30 días</h3>
          <p>Permanece activo durante 30 días para recibir nuestro máximo bono mensual de lealtad.</p>
        </div>
      </div>
      <p class="muted" style="text-align: center; margin-top: 16px;">Los bonos están sujetos a disponibilidad de tareas y evaluaciones de calidad. <strong>Las ganancias pueden variar según tu desempeño personal.</strong></p>
    </div>
  </section>

  <!-- Job Requirements -->
  <section class="section" aria-labelledby="req-title">
    <div class="container">
      <div class="section-header fade-in">
        <h2 id="req-title">🎯 Todo lo que Necesitas para Empezar</h2>
        <p class="muted">Requisitos simples para comenzar tu viaje de trabajo remoto con nosotros.</p>
      </div>
      
      <div class="requirements">
        <div class="req-item fade-in">
          <div class="req-icon">📱</div>
          <div>
            <h4>Teléfono Inteligente</h4>
            <p>Android o iOS, con internet estable.</p>
          </div>
        </div>
        <div class="req-item fade-in delay-1">
          <div class="req-icon">💸</div>
          <div>
            <h4>Ganancias por tareas</h4>
            <p>Sigue los pasos de las tareas y envía las pruebas.</p>
          </div>
        </div>
        <div class="req-item fade-in delay-1">
          <div class="req-icon">🎯</div>
          <div>
            <h4>Edad 18-65</h4>
            <p>Verificamos la edad para elegibilidad y cumplimiento.</p>
          </div>
        </div>
        <div class="req-item fade-in delay-2">
          <div class="req-icon">🤝</div>
          <div>
            <h4>Todos los géneros</h4>
            <p>Oportunidades inclusivas con reglas justas.</p>
          </div>
        </div>
        <div class="req-item fade-in delay-2">
          <div class="req-icon">⚡</div>
          <div>
            <h4>Conocimientos básicos</h4>
            <p>Leer instrucciones y entrada simple de datos.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Work From Home Benefits -->
  <section id="benefits" class="section alt">
    <div class="container">
      <div class="benefits-grid">
        <div class="benefits-media fade-in"></div>
        <div class="benefits-copy fade-in delay-1">
          <h2>🏠 Trabajo real desde casa (o desde donde prefieras)</h2>
          <ul class="stats">
            <li><strong>50.000+</strong> solicitantes</li>
            <li><strong>100.000+</strong> tareas ofrecidas</li>
            <li><strong>500+</strong> personal de apoyo</li>
            <li><strong>95%</strong> satisfacción</li>
          </ul>
          <p class="muted">Las cifras son totales internos actualizados periódicamente y se proporcionan para transparencia, no como garantía. <strong>Las ganancias pueden variar según tu desempeño personal.</strong></p>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="section">
    <div class="container">
      <div class="section-header fade-in">
        <h2>🌟 Opiniones de Nuestros Trabajadores Españoles</h2>
        <p class="muted">Personas reales, experiencias reales con nuestra plataforma.</p>
      </div>
      
      <div class="cards three-col">
        <blockquote class="testimonial fade-in">
          <div class="avatar">C</div>
          <p>"Tareas claras y respuestas rápidas. Recibí mi primer pago el mismo día. ¡El soporte en español fue muy útil!"</p>
          <footer>— Carla, Las Palmas</footer>
        </blockquote>
        <blockquote class="testimonial fade-in delay-1">
          <div class="avatar">J</div>
          <p>"Lo hago después de mi trabajo principal. La flexibilidad para obtener ingresos adicionales es excelente."</p>
          <footer>— Javier, Tenerife</footer>
        </blockquote>
        <blockquote class="testimonial fade-in delay-2">
          <div class="avatar">M</div>
          <p>"Pasos simples con expectativas justas. Sin tarifas de solicitud ni costos ocultos. ¡Definitivamente lo recomiendo!"</p>
          <footer>— Marta, Lanzarote</footer>
        </blockquote>
      </div>
    </div>
  </section>

  <!-- Limited Opportunity -->
  <section class="section cta">
    <div class="container cta-inner fade-in">
      <div>
        <h2>⏰ Plazas Limitadas - Solicita Ahora</h2>
        <p class="muted">Se añaden nuevas tareas diariamente, pero las posiciones se llenan rápidamente. Envía tu solicitud ahora para asegurar tu lugar.</p>
      </div>
      <button class="btn btn-primary btn-lg pulse open-form-btn">🚀 Solicitar Ahora</button>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="section alt">
    <div class="container">
      <div class="section-header fade-in">
        <h2>❓ Preguntas Frecuentes</h2>
        <p class="muted">Todo lo que necesitas saber antes de comenzar.</p>
      </div>
      
      <details class="faq fade-in">
        <summary>¿Hay algún costo para solicitar?</summary>
        <div>No. Nunca cobramos tarifas de solicitud o registro. Nuestra plataforma es completamente gratuita para unirse y usar.</div>
      </details>
      <details class="faq fade-in">
        <summary>¿Cómo funcionan los pagos?</summary>
        <div>Los pagos se procesan después de que las tareas pasan los controles de calidad. El tiempo puede variar según el método y la región, pero la mayoría de los trabajadores reciben el pago dentro de las 24 horas posteriores a la finalización de la tarea. <strong>El monto de las ganancias depende de tu desempeño personal.</strong></div>
      </details>
      <details class="faq fade-in">
        <summary>¿Qué equipo necesito?</summary>
        <div>Un teléfono inteligente y conexión a Internet son suficientes para la mayoría de las tareas. Algunos puestos pueden preferir computadora, pero no es necesario para la mayoría de tareas.</div>
      </details>
      <details class="faq fade-in">
        <summary>¿Cómo se comunicarán conmigo?</summary>
        <div>Nos comunicamos principalmente a través de WhatsApp. Después de solicitar, recibirás instrucciones paso a paso.</div>
      </details>
      
      <div class="disclaimer fade-in">
        <strong>⚠️ Nota Importante:</strong> Los montos de ganancia indicados en este sitio son ejemplos y no están garantizados. Tus ganancias reales variarán según tu esfuerzo personal, tiempo dedicado y desempeño en la finalización de tareas. Se requiere trabajo constante y adherencia a las instrucciones para obtener resultados exitosos.
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container footer-grid">
      <div>
        <a class="brand" href="#top">TrabajoCan</a>
        <p class="muted small">Oportunidades transparentes. No hay ingresos garantizados. Sin tarifas de solicitud.</p>
      </div>
      <nav class="footer-links">
        <a id="privacy" href="privacy.html" rel="nofollow">Política de Privacidad</a>
        <a id="terms" href="userterms.html" rel="nofollow">Términos de Uso</a>
      </nav>
    </div>
    <div class="container">
      <p class="muted small">© 2023 TrabajoCan. Todos los derechos reservados. Los ingresos mostrados son solo ejemplos y no están garantizados. Tus ganancias reales dependerán de tus habilidades, tiempo y disponibilidad de tareas. Las ganancias pueden variar según tu desempeño personal.</p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // WhatsApp account numbers
      const whatsappAccounts = [
        "6281315775782", 
        "6282171594775",
        "6285719322974",
        "6285852374223", 
        "6287887029591", 
        "62882003912577",
        "6289523938617",
        "628972109762"
      ];
      
      // Canary Islands locations and names for realistic data
      const canaryLocations = ['Santa Cruz de Tenerife', 'Las Palmas', 'La Laguna', 'Telde', 'Arona', 'Arrecife', 'Puerto del Rosario', 'Los Llanos'];
      const names = ['María', 'Juan', 'Carlos', 'Elena', 'David', 'Laura', 'Sergio', 'Ana', 'Pedro', 'Isabel', 'Miguel', 'Sofia'];
      
      // Variables
      const randomAccount = whatsappAccounts[Math.floor(Math.random() * whatsappAccounts.length)];
      let userPhoneNumber = '';
      let formSubmitted = false;
      let conversionTracked = false;
      let currentRegistrationIndex = 0;
      let registrationInterval;
      
      // DOM Elements
      const phoneModal = document.getElementById('phoneModal');
      const successModal = document.getElementById('successModal');
      const phoneInput = document.getElementById('phoneInput');
      const phoneError = document.getElementById('phoneError');
      const startEarningBtn = document.getElementById('startEarningBtn');
      const goToWhatsAppBtn = document.getElementById('goToWhatsAppBtn');
      const directWhatsAppBtn = document.getElementById('directWhatsAppBtn');
      const openFormBtn = document.getElementById('openFormBtn');
      const heroCtaBtn = document.getElementById('heroCtaBtn');
      const stickyCta = document.getElementById('stickyCta');
      const phoneModalCloseBtn = document.getElementById('phoneModalCloseBtn');
      const successModalCloseBtn = document.getElementById('successModalCloseBtn');
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      const scrollTrustSection = document.getElementById('scrollTrustSection');
      const scrollTrustClose = document.getElementById('scrollTrustClose');
      const registrationsScrollContainer = document.getElementById('registrationsScrollContainer');
      const progressBar = document.getElementById('progressBar');
      const countdownTimer = document.getElementById('countdownTimer');
      const countdownContainer = document.getElementById('countdownContainer');
      const whatsappSpinner = document.getElementById('whatsappSpinner');
      
      // 使用Google官方推荐的转化跟踪方式
      function trackGoogleConversion() {
        return new Promise((resolve) => {
          if (conversionTracked) {
            resolve(true);
            return;
          }
          
          console.log('Iniciando seguimiento de conversión Google Ads...');
          
          try {
            // 方法1: 使用gtag事件 (官方推荐)
            gtag('event', 'conversion', {
              'send_to': 'AW-17524155246/zKo5CK6w5q4bEO7GlaRB',
              'value': 8.0,
              'currency': 'USD',
              'transaction_id': 'canarias_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
            });
            
            // 方法2: 使用Google Ads转化链接 (备用方案)
            const conversionPixel = new Image();
            conversionPixel.src = `https://www.googleads.g.doubleclick.net/dcm/flcm?gcid=${Date.now()}&gclsrc=aw.ds`;
            
            console.log('Evento de conversión enviado');
            conversionTracked = true;
            
            // 不等待直接解析，确保不阻塞用户体验
            resolve(true);
            
          } catch (error) {
            console.warn('Error en seguimiento de conversión:', error);
            // 即使失败也不阻塞用户流程
            resolve(false);
          }
        });
      }

      // 带重试机制的事件上报 (非阻塞)
      function trackConversionWithRetry(maxRetries = 2) {
        return new Promise(async (resolve) => {
          for (let attempt = 1; attempt <= maxRetries; attempt++) {
            try {
              const success = await trackGoogleConversion();
              if (success) {
                console.log(`Conversión rastreada exitosamente en el intento ${attempt}`);
                resolve(true);
                return;
              }
            } catch (error) {
              console.warn(`Intento ${attempt} fallido:`, error);
            }
            
            // 短暂延迟后重试
            if (attempt < maxRetries) {
              await new Promise(r => setTimeout(r, 300 * attempt));
            }
          }
          console.log('Todos los intentos de seguimiento completados (éxito o fallo)');
          resolve(false); // 即使失败也继续
        });
      }
      
      // 安全跳转到WhatsApp (新标签页)
      async function safeRedirectToWhatsApp(whatsappUrl) {
        // 保存按钮原始状态
        const originalButton = goToWhatsAppBtn ? {
          innerHTML: goToWhatsAppBtn.innerHTML,
          disabled: goToWhatsAppBtn.disabled,
          text: goToWhatsAppBtn.textContent
        } : null;
        
        // 立即更新按钮状态
        if (goToWhatsAppBtn) {
          goToWhatsAppBtn.disabled = true;
          goToWhatsAppBtn.innerHTML = '<span class="loading-spinner"></span> Abriendo WhatsApp...';
        }
        
        try {
          // 开始转化跟踪 (不等待)
          const trackingPromise = trackConversionWithRetry().then(success => {
            console.log('Resultado del tracking:', success);
          }).catch(error => {
            console.warn('Error en tracking:', error);
          });
          
          // 短暂延迟确保UI更新 (非阻塞)
          await new Promise(resolve => setTimeout(resolve, 100));
          
          // 在新标签页打开WhatsApp - 关键改进！
          const newWindow = window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
          
          if (!newWindow) {
            // 如果弹窗被阻止，回退到当前页跳转
            console.log('Popup bloqueado, redirigiendo en misma ventana');
            window.location.href = whatsappUrl;
          } else {
            // 焦点移到新窗口
            newWindow.focus();
          }
          
          // 恢复按钮状态
          setTimeout(() => {
            if (goToWhatsAppBtn && originalButton) {
              goToWhatsAppBtn.disabled = originalButton.disabled;
              goToWhatsAppBtn.innerHTML = originalButton.innerHTML;
            }
          }, 2000);
          
        } catch (error) {
          console.error('Error crítico en redirección:', error);
          
          // 恢复按钮状态
          if (goToWhatsAppBtn && originalButton) {
            goToWhatsAppBtn.disabled = originalButton.disabled;
            goToWhatsAppBtn.innerHTML = originalButton.innerHTML;
          }
          
          // 最终回退方案
          window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
        }
      }

      // 更新自动跳转逻辑
      function setupAutoRedirect(whatsappUrl) {
        let countdown = 3;
        const countdownInterval = setInterval(() => {
          if (goToWhatsAppBtn) {
            goToWhatsAppBtn.innerHTML = `💬 Abriendo WhatsApp en ${countdown}...`;
          }
          
          countdown--;
          
          if (countdown < 0) {
            clearInterval(countdownInterval);
            safeRedirectToWhatsApp(whatsappUrl);
          }
        }, 1000);
      }
      
      // 防止页面卸载中断Google事件上报
      function setupBeforeUnloadProtection() {
        let conversionSent = false;
        
        window.addEventListener('beforeunload', function() {
          if (!conversionSent) {
            // 在页面卸载前紧急发送转化事件
            try {
              gtag('event', 'conversion', {
                'send_to': 'AW-17524155246/zKo5CK6w5q4bEO7GlaRB',
                'value': 8.0,
                'currency': 'USD',
                'transaction_id': 'unload_' + Date.now()
              });
              
              // 发送像素作为最终保障
              const pixel = new Image();
              pixel.src = `https://www.googleads.g.doubleclick.net/dcm/flcm?gcid=unload_${Date.now()}`;
              
              conversionSent = true;
            } catch (error) {
              console.warn('Error en beforeunload tracking:', error);
            }
          }
        });
      }
      
      // 初始化功能
      function initializeFeatures() {
        // 原有功能
        const activeUsers = document.getElementById('activeUsers');
        let count = 15 + Math.floor(Math.random() * 10);
        if (activeUsers) {
          activeUsers.textContent = count;
        }
        
        setInterval(() => {
          count = 15 + Math.floor(Math.random() * 10);
          if (activeUsers) {
            activeUsers.textContent = count;
          }
        }, 30000);
        
        // 显示粘性CTA
        setTimeout(() => {
          if (stickyCta) {
            stickyCta.classList.add('active');
          }
        }, 3000);
        
        // 初始化实时注册 - 单条滚动形式
        initializeRealTimeRegistrations();
        
        // 设置滚动信任通知
        setupScrollTrustNotification();
        
        // 新功能：初始化倒计时
        initializeCountdown();
        
        // 新功能：设置智能弹窗
        setupSmartPopups();
        
        // 新功能：个性化内容
        updatePersonalizedContent();
        
        // 新功能：A/B测试
        setupABTesting();

        // 设置页面卸载保护
        setupBeforeUnloadProtection();
      }
      
      // 初始化实时注册信息 - 单条滚动形式
      function initializeRealTimeRegistrations() {
        // 生成初始注册数据
        const registrations = generateRegistrationData(5);
        
        // 清空容器
        if (registrationsScrollContainer) {
          registrationsScrollContainer.innerHTML = '';
          
          // 添加第一条注册信息
          if (registrations.length > 0) {
            const firstItem = document.createElement('div');
            firstItem.className = 'registration-item active';
            firstItem.innerHTML = registrations[0];
            registrationsScrollContainer.appendChild(firstItem);
          }
        }
        
        // 设置定时器，每4秒切换一条信息
        currentRegistrationIndex = 1;
        registrationInterval = setInterval(() => {
          rotateRegistration();
        }, 4000);
      }
      
      // 生成注册数据
      function generateRegistrationData(count) {
        const registrations = [];
        
        for (let i = 0; i < count; i++) {
          const name = names[Math.floor(Math.random() * names.length)];
          const location = canaryLocations[Math.floor(Math.random() * canaryLocations.length)];
          const minutes = Math.floor(Math.random() * 15);
          
          registrations.push(`
            <span class="status-dot"></span>
            <strong>${name}</strong> de <strong>${location}</strong>
            <span class="time">hace ${minutes} min</span>
          `);
        }
        
        return registrations;
      }
      
      // 旋转注册信息
      function rotateRegistration() {
        if (!registrationsScrollContainer) return;
        
        const registrations = generateRegistrationData(5);
        const currentItem = registrationsScrollContainer.querySelector('.registration-item');
        
        if (currentItem) {
          // 淡出当前项
          currentItem.classList.remove('active');
          
          setTimeout(() => {
            // 移除当前项
            registrationsScrollContainer.removeChild(currentItem);
            
            // 添加新项
            const newItem = document.createElement('div');
            newItem.className = 'registration-item';
            newItem.innerHTML = registrations[currentRegistrationIndex % registrations.length];
            registrationsScrollContainer.appendChild(newItem);
            
            // 触发重排以应用动画
            void newItem.offsetWidth;
            
            // 淡入新项
            newItem.classList.add('active');
            
            // 更新索引
            currentRegistrationIndex = (currentRegistrationIndex + 1) % registrations.length;
          }, 500);
        }
      }
      
      // 设置滚动信任通知
      function setupScrollTrustNotification() {
        let trustShown = false;
        
        window.addEventListener('scroll', function() {
          const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
          
          if (scrollPercent > 40 && !trustShown && scrollTrustSection) {
            trustShown = true;
            showScrollTrustNotification();
          }
        });
        
        if (scrollTrustClose) {
          scrollTrustClose.addEventListener('click', function() {
            scrollTrustSection.classList.remove('active');
          });
        }
      }
      
      function showScrollTrustNotification() {
        setTimeout(() => {
          if (scrollTrustSection) {
            scrollTrustSection.classList.add('active');
            
            // 8秒后自动隐藏
            setTimeout(() => {
              scrollTrustSection.classList.remove('active');
            }, 8000);
          }
        }, 1000);
      }
      
      // 初始化倒计时
      function initializeCountdown() {
        let timeLeft = 30 * 60; // 30分钟
        
        const countdown = setInterval(() => {
          timeLeft--;
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;
          if (countdownTimer) {
            countdownTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
          }
          
          // 最后5分钟警告
          if (timeLeft === 5 * 60 && countdownContainer) {
            countdownContainer.style.background = 'linear-gradient(135deg, #ff4757, #ff6b6b)';
            countdownContainer.style.animation = 'pulse 1s infinite';
          }
          
          if (timeLeft <= 0) {
            clearInterval(countdown);
            if (countdownTimer) {
              countdownTimer.textContent = "¡OFERTA TERMINADA!";
            }
            if (countdownContainer) {
              countdownContainer.style.background = '#666';
            }
            // 禁用所有CTA按钮
            document.querySelectorAll('.btn-primary, .open-form-btn').forEach(btn => {
              btn.disabled = true;
              btn.textContent = 'Oferta Finalizada';
              btn.style.opacity = '0.6';
            });
          }
        }, 1000);
      }
      
      // 智能弹窗系统
      function setupSmartPopups() {
        let scrollDepth = 0;
        let timeOnPage = 0;
        let exitIntentDetected = false;
        
        // 跟踪滚动深度
        window.addEventListener('scroll', function() {
          scrollDepth = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
          
          // 60%滚动深度触发
          if (scrollDepth > 60 && !formSubmitted) {
            showScrollCTA();
          }
        });
        
        // 跟踪页面停留时间
        setInterval(() => {
          timeOnPage++;
          
          // 25秒后显示弹窗
          if (timeOnPage === 25 && scrollDepth > 20 && !formSubmitted) {
            showTimeBasedCTA();
          }
        }, 1000);
        
        // 退出意图检测
        document.addEventListener('mouseout', function(e) {
          if (e.clientY < 50 && !exitIntentDetected && !formSubmitted && scrollDepth > 10) {
            exitIntentDetected = true;
            showExitIntentModal();
          }
        });
      }
      
      // 显示退出意图弹窗
      function showExitIntentModal() {
        if (document.getElementById('exitModal')) return;
        
        const exitModalHtml = `
          <div class="modal active exit-modal" id="exitModal">
            <div class="modal-content">
              <button class="modal-close" onclick="closeExitModal()" aria-label="Cerrar">&times;</button>
              <div class="modal-header">
                <div class="modal-icon">🚨</div>
                <h3 class="modal-title">¡Espera! No te vayas aún</h3>
                <p class="modal-subtitle">Última oportunidad para asegurar tu plaza con ingresos de 150-300€ diarios</p>
              </div>
              <button class="btn btn-primary btn-block" onclick="openPhoneModal(); closeExitModal();">
                🚀 Quiero Mi Plaza
              </button>
              <button class="btn" onclick="closeExitModal()" style="margin-top: 8px; background: transparent; border: 1px solid var(--muted);">
                Continuar navegando
              </button>
            </div>
          </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', exitModalHtml);
      }
      
      // 关闭退出弹窗
      function closeExitModal() {
        const exitModal = document.getElementById('exitModal');
        if (exitModal) {
          exitModal.remove();
        }
      }
      
      // 个性化内容
      function updatePersonalizedContent() {
        const hour = new Date().getHours();
        let greeting = '';
        
        if (hour < 12) greeting = '¡Buenos días!';
        else if (hour < 18) greeting = '¡Buenas tardes!';
        else greeting = '¡Buenas noches!';
        
        // 更新标题
        const heroTitle = document.querySelector('.hero-copy h1');
        if (heroTitle) {
          heroTitle.innerHTML = `${greeting} Canarios, Gana 150-300€ Diarios SIN Salir de Tu Casa`;
        }
      }
      
      // A/B测试
      function setupABTesting() {
        const testVariations = {
          ctaText: [
            "🚀 Quiero Mi Plaza - Comenzar en 24h",
            "💰 Comenzar a Ganar Dinero Hoy", 
            "🎯 Obtener Mi Trabajo Remoto",
            "🌴 Trabajar Desde Canarias Ahora"
          ]
        };
        
        const ctaVariant = Math.floor(Math.random() * testVariations.ctaText.length);
        
        // 更新主要CTA按钮
        const mainCtas = document.querySelectorAll('#heroCtaBtn, .sticky-content .btn');
        mainCtas.forEach(btn => {
          if (btn.id !== 'goToWhatsAppBtn') {
            btn.textContent = testVariations.ctaText[ctaVariant];
          }
        });
      }
      
      // 更新进度条
      function updateProgress(step) {
        if (progressBar) {
          if (step === 2) {
            progressBar.style.width = '100%';
            const progressHeader = document.querySelector('.progress-header span:last-child');
            if (progressHeader) {
              progressHeader.textContent = 'Paso 2 de 2';
            }
          }
        }
      }
      
      // 打开电话模态框
      function openPhoneModal() {
        if (phoneModal) {
          phoneModal.classList.add('active');
        }
        if (phoneInput) {
          phoneInput.focus();
        }
        // 重置进度条
        if (progressBar) {
          progressBar.style.width = '50%';
          const progressHeader = document.querySelector('.progress-header span:last-child');
          if (progressHeader) {
            progressHeader.textContent = 'Paso 1 de 2';
          }
        }
      }
      
      // 关闭电话模态框
      function closePhoneModal() {
        if (phoneModal) {
          phoneModal.classList.remove('active');
        }
        clearPhoneError();
      }
      
      // 打开成功模态框
      function openSuccessModal() {
        if (successModal) {
          successModal.classList.add('active');
        }
      }
      
      // 关闭成功模态框
      function closeSuccessModal() {
        if (successModal) {
          successModal.classList.remove('active');
        }
      }
      
      // 清除电话错误
      function clearPhoneError() {
        if (phoneInput) {
          phoneInput.classList.remove('error');
        }
        if (phoneError) {
          phoneError.classList.remove('show');
        }
      }
      
      // 验证电话号码
      function validatePhoneNumber(phone) {
        const cleaned = phone.replace(/\D/g, '');
        return cleaned.length >= 8;
      }
      
      // 生成WhatsApp链接
      function generateWhatsAppLink(phone) {
        const message = encodeURIComponent(`Hola, me interesan los trabajos remotos en Canarias. Mi número es: ${phone}`);
        return `https://wa.me/${randomAccount}?text=${message}`;
      }
      
      // 处理电话表单提交
      function handlePhoneSubmit() {
        const phone = phoneInput ? phoneInput.value.trim() : '';
        
        if (!validatePhoneNumber(phone)) {
          if (phoneInput) {
            phoneInput.classList.add('error');
          }
          if (phoneError) {
            phoneError.classList.add('show');
          }
          if (phoneInput) {
            phoneInput.focus();
          }
          return;
        }
        
        userPhoneNumber = phone;
        formSubmitted = true;
        
        // 更新进度条
        updateProgress(2);
        
        // 生成WhatsApp链接
        const whatsappUrl = generateWhatsAppLink(phone);
        
        // 关闭电话模态框并打开成功模态框
        closePhoneModal();
        openSuccessModal();
        
        // 更新WhatsApp按钮事件 - 使用新标签页
        if (goToWhatsAppBtn) {
          goToWhatsAppBtn.onclick = function() {
            safeRedirectToWhatsApp(whatsappUrl);
          };
        }
        
        // 设置自动跳转 (新标签页)
        setupAutoRedirect(whatsappUrl);
      }
      
      // 直接WhatsApp跳转（无表单）- 同样使用新标签页
      function handleDirectWhatsApp() {
        const whatsappUrl = `https://wa.me/${randomAccount}?text=${
          encodeURIComponent("Hola, estoy interesado en los trabajos remotos en Canarias")
        }`;
        
        // 先触发转化跟踪
        trackConversionWithRetry().then(success => {
          console.log('Direct WhatsApp tracking result:', success);
        });
        
        // 立即在新标签页打开
        window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
      }
      
      // 事件监听器
      if (openFormBtn) {
        openFormBtn.addEventListener('click', openPhoneModal);
      }
      if (heroCtaBtn) {
        heroCtaBtn.addEventListener('click', openPhoneModal);
      }
      
      // 直接WhatsApp按钮
      if (directWhatsAppBtn) {
        directWhatsAppBtn.addEventListener('click', handleDirectWhatsApp);
      }
      
      // 电话表单提交
      if (startEarningBtn) {
        startEarningBtn.addEventListener('click', handlePhoneSubmit);
      }
      
      // 移动菜单切换
      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', function() {
          if (mobileMenu) {
            mobileMenu.classList.toggle('active');
          }
        });
      }
      
      // 关闭移动菜单当点击外部
      document.addEventListener('click', function(e) {
        if (mobileMenu && mobileMenuBtn && !mobileMenu.contains(e.target) && e.target !== mobileMenuBtn) {
          mobileMenu.classList.remove('active');
        }
      });
      
      // 电话输入事件
      if (phoneInput) {
        phoneInput.addEventListener('input', function() {
          // 只允许数字
          this.value = this.value.replace(/\D/g, '');
          clearPhoneError();
        });
        
        phoneInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            handlePhoneSubmit();
          }
        });
      }
      
      // 模态框关闭按钮
      if (phoneModalCloseBtn) {
        phoneModalCloseBtn.addEventListener('click', closePhoneModal);
      }
      if (successModalCloseBtn) {
        successModalCloseBtn.addEventListener('click', closeSuccessModal);
      }
      
      // 通过点击外部关闭模态框
      if (phoneModal) {
        phoneModal.addEventListener('click', function(e) {
          if (e.target === phoneModal) {
            closePhoneModal();
          }
        });
      }
      
      if (successModal) {
        successModal.addEventListener('click', function(e) {
          if (e.target === successModal) {
            closeSuccessModal();
          }
        });
      }
      
      // 为导航添加平滑滚动
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        if (anchor.getAttribute('href') !== '#' && 
            !anchor.classList.contains('open-form-btn')) {
          anchor.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;
            
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        }
      });
      
      // 更新页面上的所有CTA按钮以打开电话模态框
      document.querySelectorAll('.open-form-btn, .btn-primary').forEach(btn => {
        if (!btn.id && !btn.onclick) { // 避免在具有特定ID的按钮上重复事件
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            openPhoneModal();
          });
        }
      });
      
      // 初始化所有功能
      initializeFeatures();
      
      // 将全局函数暴露给DOM
      window.openPhoneModal = openPhoneModal;
      window.closeExitModal = closeExitModal;
    });
  </script>
</body>
</html>
